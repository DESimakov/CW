# CW 
Здесь будут выкладываться файлы с продвижением в написании курсовой работы.
## Данные
1) [Сырые данные для разных ставок](https://github.com/DESimakov/CW/blob/master/mosprime.csv) 
2) [Данные для MOSPRIME 3m полные с 01-09-2007 по 22-12-2017](https://github.com/DESimakov/CW/blob/master/mosprime3m.csv)
3) [Данные для MOSPRIME 3m средние с 01-04-2010 по 01-04-2013](https://github.com/DESimakov/CW/blob/master/mosprime3m_between.csv)
4) [Данные для MOSPRIME 3m короткие с 02-04-2012 по 31-08-2012](https://github.com/DESimakov/CW/blob/master/mosprime3m_short.csv)
## Визуализация данных
* Графики данных. Сравнение разных временных отрезков, их гистограммы. Месячное скользящее среднее для ставки, ее волатильности. [Ноутбук](https://github.com/DESimakov/CW/blob/master/CW_data_and_visualisation.ipynb) 

* Предварительное разделение на периоды. [Ноутбук](https://github.com/DESimakov/CW/blob/master/CW_periods.ipynb)

## Калибровка ошибки MAPE
Для моделей Мертона и однофакторной Халла-Вайта найдены оптимальные параметры путем минимизации ошибки MAPE. [Ноутбук](https://github.com/DESimakov/CW/blob/master/CWm-calibration_MAPE.ipynb)
## Калибровка при помощи максимизации правдоподобия
Для моделей Мертона и однофакторной Халла-Вайта найдены оптимальные параметры путем максимизации функции правдоподобия. Определение влияния начального приближения. Добавлена стандартная реализация для HW1.[Ноутбук](https://github.com/DESimakov/CW/blob/master/CWm-calibration_ML.ipynb)
### Сравнение разных предпосылок о распределении для Мертона + скользящее окно
Нормальная реализация МП для приращений. Оценка параметров методом наименьших квадратов. Скользящее окно. **Графики параметров модели**. [Ноутбук](https://github.com/DESimakov/CW/blob/master/CW_Merton_OLS_and_Rolling.ipynb)

### HW1 разные вариации + скользящее окно
Нормальная реализация МП для приращений. Оценка параметров методом наименьших квадратов. Скользящее окно. **Графики параметров модели**.  [Ноутбук](https://github.com/DESimakov/CW/blob/master/CW_HW1_OLS+nonparametricmean+p0.ipynb)

### CIR + скользящее окно + C0 расстояния ecdf
Нормальная реализация МП для приращений. Оценка параметров минимизацией максимального отклониения траекторий от данных. **Графики параметров модели**. [Ноутбук](https://github.com/DESimakov/CW/blob/master/CW_CIR.ipynb )

Градиентный спуск. [Ноутбук](https://github.com/DESimakov/CW/blob/master/CW_CIR_FGD.ipynb)

### HW1 и CIR на сгенерированных данных
* HW1. [Ноутбук](https://github.com/DESimakov/CW/blob/master/CW_HW1_gen_data.ipynb )
* CIR. [Ноутбук](https://github.com/DESimakov/CW/blob/master/CW_CIR_gen_data.ipynb )

## Использование пакета Quant-Lib (искусственный пример)
Калибровка параметров HW1f по цене свапциона. [Ноутбук](https://github.com/DESimakov/CW/blob/master/CW_QuantLib.ipynb)

## Проблемные моменты:
* Результаты очень сильно меняются в зависимости от способа вычислений - численные методы разнятся между собой. Даже градиентный спуск. На сгенерированных данных наблюдается устойчивость, HW1 относительно неплохо находит истинные параметры, CIR - плохо находит alpha - нужно очень много наблюдений (порядка 5-10 тысяч). Но на реальных данных устойчивости не наблюдается. Стоит продолжить проводить эксперименты на сгенерированных данных (устойчивость алгоритмов, их точность, возможность учесть кризисы)?
* Структура данных говорит, что наблюдается маленькие джампы, после которых, скорее всего, не меняется тип распределения, и большие джампы, после которых ускоряется возврат к среднему. Как смоделировать?

## Первый приоритет:
- [ ] Сравнить модели и сделать выводы. (*но на реальных данных или сгенерированных?*)
- [ ] потестить разладки для определения момента переключения. (Вероятнее всего - разладка на начало кризиса, на восстановление, на нормальный период) (*но мало данных на сам кризис и на восстановление после него, скорее всего, не сработает*)
- [ ] HW1 в своей реализации посмотреть на полных данных при фрагментации на отрезки - не кризис, подъем, стагнация. Будет ли нормальный учет  кризисов? Построить траектории на будущее. (*все плохо*)

## Второй приоритет:
- [ ] Смоделировать процесс формирования ставки: убрать 2 максимума, 2 минимума, остальное - среднее по моментам времени. Разные распределения.
- [ ] Добавить Jump процессы.
- [ ] dt - учитывает фактическое количество дней между наблюдениями.
- [ ] Посмотреть на VaR.

## Сделано:
- [x] Посмотреть на <a href="https://www.codecogs.com/eqnedit.php?latex=\theta(t)&space;=&space;const" target="_blank"><img src="https://latex.codecogs.com/gif.latex?\theta(t)&space;=&space;const" title="\theta(t) = const" /></a> . (*аналогичные проблемы*)
- [x] ~~Сделать алгоритм, который подбирает параметры по заданной волатильности (в два шага).~~ (*Для максимального правдоподобия у HW1 вышло, что для в зависимости от начального приближения он каждый раз выбирает одни и те же параметры для разных волатильностей*)
- [x] ~~HW1 численное вычисление интеграла, для подсчета любой функции~~<a href="https://www.codecogs.com/eqnedit.php?latex=\theta(t)&space;=&space;const" target="_blank"><img src="https://latex.codecogs.com/gif.latex?\theta(t)" title="\theta(t)" /></a> (*не надо*)
- [x] Подбор начального приближения. Из мнк? На основе выборочных моментов? (*хорошая идея - выборочные моменты*)
- [x] ~~Случайная выборка параметров в правдоподобии.~~ (*мало данных - совсем плохие значения, либо не сходится*)
- [x] ~~Так как при dt параметры не случайны, оценить их методом наименьших квадратов, а волатильность оценить при помощи максимального правдоподобия. Добавить регуляризацию!~~ (*Особого эффекта нет, все плохо*)
- [X] Сделать функцию расстояний.
- [X] Сделать скользящее окно для Merton.
- [X] Сделать скользящее окно для HW1.
- [X] Сделать скользящее окно для CIR.

#### TODO List
* Другие способы оптимизации (*разные вариации численных методов не показали хороший результат*). Градиентный спуск максимального правдоподобия? (*не очень хорошо себя показал - на реальных данных все равно сходится около начального приближения*)
* Сделать уже функции для отрисовки графиков/путей/скользящиз и запихнуть их в .py . Написать класс.
